# xray-server-auto-install
По всем вопросам телеграмм [@lonely_melancholy](https://t.me/lonely_melancholy)
v. предварительная
### О проекте.
Данный проект в целом задумывался как отход от привычных панелей управления xray как от перегруженных костыльных решениях, в частности мне не нравится мониторинг у того же 3x-ui где для просмотра информации о сервере я должен либо тыкать миллион кнопок в боте либо логинится в панель, разбиратся в куче видов этих панелей и пытатся закастомить их под себя не было никакого желания, а так же мне надоело настраивать кучу софта при установке, и обновлять все это руками. Тогда и было начато создание этого скрипта, он предназначен для автоматической установки и полной настройки VPN сервера для личного использования. Так же еще десяток скриптов ставится на систему для всех автоматических работ и упрощения работы с чистым xray по типу добавления и удаления пользователей. В конечном результате вы получаете сервер:
1. Без лишних открытых портов и лишнего установленного софта, наружу будет торчать только ssh и xray
2. SSH доступом настроенным на безопасность уровня параноик и доступом по ключу
3. Включенный fail2ban для исключений попыток брутфорса SSH
4. Чистый Xray core без панелей и надстроек, все действия через несколько баш скриптов
5. Автоматические обновления geo баз, xray, безопастности системы и авто перезагрузкой при необходимости, автобан юзеров по истечению их времени, независимый сбор статистики трафика со сбросом раз в месяц.
6. Уведомления в Телеграмм бота о включении сервера, логине по ssh и разлогине, уведомление о потраченном трафике за месяц, уведомление о оставшемся времени у юзеров, уведомление о обновлении и перезагрузке сервера, уведомление о обновлении xray, уведомления о обнаруженных и забаненых за брутфорс ip адресах и их разбане.

### Обязательные требования:
- Свежая установка для избежания конфликтов конфигураций Ubuntu 22.04 и новее.
- Подготовленный в конфигурационном файле - новый пароль, ник для администратора сервера, телеграмм бот token, id кому бот будет слать сообщения, dest сайт под который маскируемся, одно имя для генерации конфигурации впн, количество дней которые действует это имя (0 - бесконечно).

### Необязательные требования:
- Ключ Ubuntu pro

### Установка:
- Скачайте скрипт в любую директорию `git clone https://github.com/LonelyMelancholy/vless-vpn-server-auto-install.git`
- Заполните конфигурационный файл для автоустановки `configuration.cfg`
- Предполагается что вы работаете от root, если нет используйте `sudo -i`
- Запустите `./pred-install.sh`, скрипт проверит правильность заполнения и обновит систему
- Запустите `./install.sh` установит все необходимые программы и настройки
- Скопируйте приватный ключ который в конце установки выдаст скрипт и порт подключения, настройте ssh клиент для работы с ним, если у вас несколько ключей для разных серверов ssh-agent использовать нельзя, он перебирает ключи по очереди при подключении и после 3 неправильного ключа вас забанит.

### Управление сервером и xray:
- Полное управление через telegram бота. Без надобности логинится на сервер.
- 
### Управление сервером по ssh
- Залогиньтесь за нового администратора по ssh, в домашней директории лежат скрипты управления
- Добавление нового клиента `sudo ./xray_user_add <name> <days>`
- Ручная блокировка или разблокировка клиента `sudo ./xray_user_block <name> <block|unblock>`
- Удаление клиента `sudo ./xray_user_del <name>`
- Установка клиенту нового времени действия аккаунта и разблокировка если его заблокировало автоматически по истечению времени `sudo ./xray_user_exp <name> <days>`
- Просмотр всей статистики по клиентам `sudo ./xray_user_show all`
- Просмотр клиентских ссылок `sudo ./xray_user_show link`
- Просмотр клиентов забаненых вручную `sudo ./xray_user_show block`
- Просмотр клиентов забаненых автоматически после истечения времени `sudo ./xray_user_show exp`

### Автоматические работы:
- Автобан по истечению у юзера времени в 0:00 с уведомлением
- Уведомление о трафике юзеров и сервера за месяц со сбросом трафика каждого первого числа и о количестве оставшихся дней у юзеров в 1:00
- Обновление Xray каждое первое число месяца в 2:00 с уведомлением
- Обновления безопасности системы каждое первое число месяца в 3:00 (с возможной автоматической перезагрузкой по надобности) с уведомлением

### Структура проекта:
Все конфигурационные файлы устанавливаемые на систему находятся в cfg/
Все устанавливаемые на систему скрипты находятся в script/

### Места установки:
- Скрипты уведомлений /usr/local/bin/telegram
- Скрипты сервисные /usr/local/bin/service
- Логи скриптов уведомлений /var/log/telegram
- Логи сервисных скриптов /var/log/service
- Логи xray /var/log/xray

### TO_DO List
- улучшение обработки ошибок в функциях по set -e
- учет того что бы одновременно не запускались авто работы которые работают с апи и статистикой, например юзерстат и юзер нотифи юзают общий файл статистики
сделать бекап анбекап - конфига, база ссылок, база трафика
при выборе пользователя его инфа с ип